import{i as C,u as F,dE as g,bi as L,r as d,c as $,o as k,d as u,b as o,t as x,e as r,ah as V,s as h,F as I,h as U,f as D,_ as q,ba as M,b7 as A}from"./main-BZyHWxP-.js";import{_ as H}from"./FieldRenderer-ClWx76-A.js";import{u as R}from"./useApi-CqDIhdYp.js";import{c as E}from"./createUrl-RWZycZLg.js";import{$ as z}from"./api-0WedtC8c.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as w,a as v}from"./VRow-B20rruVT.js";import{V as J}from"./VCard-BHQDPESW.js";import{V as K}from"./VCardText-CmyiQv4t.js";import{V as O}from"./VForm-BpUU7xqx.js";import{V as Q}from"./VSnackbar-r55CRLic.js";import"./AppDateTimePicker-Bt5bw6tg.js";import"./VField-CoXLbqml.js";import"./TiptapEditor-DOeDfFDI.js";import"./index-C3nn1atq.js";import"./index-Dxkci4Dk.js";import"./VDivider-CktbFQ7a.js";import"./validators-DpYrMFzk.js";import"./helpers-DK5QwNv0.js";import"./VTextField-BzLGB-co.js";import"./autofocus-DThxoTWr.js";import"./VCounter-D2PtsxdL.js";import"./VTextarea-DciDp74g.js";import"./VAutocomplete-akOlU6OV.js";import"./VSelect-CI_o2-A6.js";import"./VList-DbFeSWDW.js";import"./ssrBoot-DURCToRA.js";import"./VAvatar-8Zwc_tqP.js";import"./VCheckboxBtn-qZOqlrBl.js";import"./VSelectionControl-DwoCMlaG.js";import"./VChip-CeQObjZq.js";import"./VSlideGroup-CbdWe5cW.js";import"./filter-Da5uf3G2.js";import"./VSwitch-DLSIbHZW.js";import"./VFileInput-B00mRcAE.js";import"./index-CvOPxmL5.js";const W={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},X={class:"d-flex flex-column justify-center"},Y={class:"text-h4 font-weight-medium"},Z={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},ee={class:"d-flex gap-4 align-center flex-wrap"},ae=["innerHTML"],te={__name:"[id]",async setup(oe){let i,p;const T=C(),N=F(),_=g({api:{endPoint:"location",itemName:"Location",query:{}}}),s=g({name:"Localisation",backName:"une",secondBackName:"la",backRoute:{name:"Localisation",endPoint:"location"},api:{isLoading:!1}}),{data:j}=([i,p]=L(()=>R(E(`/${_.api.endPoint}/${N.params.id}`,{query:_.api.query}))),i=await i,p(),i),n=d(j.value.data[_.api.itemName]),y={api:{endpoint:"location",method:"PUT"},backRouteName:"location"};function B(){l.forEach(e=>{e.errors=null})}const l=g([{type:"text",label:"Nom",value_key:"name",default_value:"TEST",errors:null,required:!0,cols:{cols:12,sm:12,md:12,lg:12}},{type:"lov",label:"Niveau",value_key:"level",errors:null,required:!0,default_value:"region",cols:{cols:12,sm:12,md:12,lg:12},data:{list:{id:"id",name:"name",source:"array",api:{endpoint:null,query:{},execute:null,data:null},items:[{id:"region",name:"Région"},{id:"prefecture",name:"Préfecture"}],multiple:!1}}},{type:"lov",label:"Parent",value_key:"parent_id",errors:null,required:!1,default_value:null,clearable:!0,cols:{cols:12,sm:12,md:12,lg:12},data:{list:{id:"id",name:"name",source:"api",api:{endpoint:"location",query:{},execute:null,data:null},items:[],multiple:!1}}}]);for(let e=0;e<l.length;e++)if(l[e].type==="lov"&&l[e].data.list.source==="api"){const{data:a,execute:t}=([i,p]=L(()=>R(E(`/${l[e].data.list.api.endpoint}`,{query:l[e].data.list.api.query}))),i=await i,p(),i);l[e].data.list.api.data=a,l[e].data.list.api.execute=t,l[e].data.list.items=l[e].data.list.api.data.data}n.value&&Array.isArray(n.value.locations)&&(n.value.locations=n.value.locations.map(e=>typeof e=="object"&&e!==null?e.id:e));const b=d(),P=()=>{b.value?.validate().then(async({valid:e})=>{if(s.api.isLoading=!0,e){B();const a=await z(`/${y.api.endpoint}/${N.params.id}`,{method:y.api.method,body:n.value});if(a?.status==200)m.value=`${s.name} modifié avec succès`,f.value="success",c.value=!0,T.push({name:y.backRouteName});else if(a?.errors){l.forEach(t=>{a.errors[t.value_key]&&(t.errors=a.errors[t.value_key])}),m.value="";for(const t in a.errors)a.errors[t]&&(m.value+=`${a.errors[t]}`);f.value="error",c.value=!!m.value}else m.value=a?.message??"Une erreur inconnue est survenue.",f.value="error",c.value=!0;A(()=>{b.value?.resetValidation()})}s.api.isLoading=!1})},c=d(!1),m=d(""),f=d("success");return(e,a)=>(k(),$("div",null,[u("div",W,[u("div",X,[u("h4",Y," Modifier "+x(s.backName)+" "+x(s.name),1)])]),o(O,{ref_key:"refForm",ref:b,onSubmit:M(P,["prevent"])},{default:r(()=>[o(w,null,{default:r(()=>[o(v,{cols:"11"},{default:r(()=>[o(V,{"prepend-icon":"tabler-arrow-narrow-left",to:{name:s.backRoute.endPoint}},{default:r(()=>[h(x(s.backRoute.name),1)]),_:1},8,["to"])]),_:1})]),_:1}),o(w,null,{default:r(()=>[o(v,{md:"12"},{default:r(()=>[o(J,{class:"mb-6",title:`Informations sur ${s.secondBackName} ${s.name}`},{default:r(()=>[o(K,null,{default:r(()=>[o(w,null,{default:r(()=>[(k(!0),$(I,null,U(l,t=>(k(),D(v,{key:t.value_key,cols:t.cols.cols??12,sm:t.cols.sm??12,md:t.cols.md??12,lg:t.cols.lg??12},{default:r(()=>[o(H,{modelValue:n.value[t.value_key],"onUpdate:modelValue":S=>n.value[t.value_key]=S,field:t},null,8,["modelValue","onUpdate:modelValue","field"])]),_:2},1032,["cols","sm","md","lg"]))),128))]),_:1})]),_:1})]),_:1},8,["title"])]),_:1}),o(v,{cols:"12"},{default:r(()=>[u("div",Z,[a[3]||(a[3]=u("div",{class:"d-flex flex-column justify-center"},null,-1)),u("div",ee,[o(V,{type:"reset",variant:"tonal",color:"primary"},{default:r(()=>[o(q,{start:"",icon:"tabler-circle-minus"}),a[1]||(a[1]=h(" Effacer ",-1))]),_:1}),o(V,{type:"submit",class:"me-3",loading:s.api.isLoading,disabled:s.api.isLoading},{default:r(()=>[a[2]||(a[2]=h(" Enregistrer ",-1)),o(q,{end:"",icon:"tabler-checkbox"})]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1})]),_:1},512),o(Q,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t),transition:"scale-transition",location:"top end",color:f.value},{default:r(()=>[u("div",{innerHTML:m.value},null,8,ae)]),_:1},8,["modelValue","color"])]))}},De=G(te,[["__scopeId","data-v-c3abf285"]]);export{De as default};
