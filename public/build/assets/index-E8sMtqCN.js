import{p as re}from"./paginationMeta-DF6W6vpY.js";import{_ as ue}from"./AppTextarea-DakcUeQ4.js";import{_ as de}from"./DialogCloseBtn-CkHdUiBt.js";import{_ as me}from"./AppTextField-DEFx5LB3.js";import{_ as pe}from"./AppAutocomplete-CbqjuExQ.js";import{$ as ce}from"./api-CXpAJbKn.js";import{r as s,bd as fe,dG as K,bi as ve,Y as R,E as ge,w as be,bO as Ve,a as ye,c as W,o as c,b as a,e as o,d,t as $,F as _e,h as ke,f as g,b1 as f,l as i,k as C,ah as b,s as m,_ as V,p as X,b8 as q}from"./main-B_3U4rnL.js";import{u as Z}from"./useApi-2ULgWkV5.js";import{c as ee}from"./createUrl-DSuaXwyR.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as P}from"./VCardText-CbE5M2-5.js";import{V as te,a as we}from"./VRow-rSP3UPT0.js";import{V as L}from"./VCard-CHvE1CVF.js";import{V as N}from"./VDivider-CHuFBZ5S.js";import{V as $e}from"./VDataTableServer-CGm-GRl8.js";import{V as Ce}from"./VPagination-ChFIHnfN.js";import{V as Pe}from"./VDialog-Dk8XMq47.js";import{V as Ee}from"./VSnackbar-XjXLO0OV.js";import"./VTextarea-hCZEX-uB.js";import"./autofocus-Bw9dR2w9.js";import"./VCounter-D_guRIhI.js";import"./VField-3YJ8FXmc.js";import"./VTextField-eMdtVNtb.js";import"./VAutocomplete-B6b0HexW.js";import"./VSelect-DQ-4196m.js";import"./VList-Ce9acDAh.js";import"./ssrBoot-DCfCAOKs.js";import"./VAvatar-K7hB1Kku.js";import"./VCheckboxBtn-DobkZaJy.js";import"./VSelectionControl-DLNDeEFn.js";import"./VChip-BAqKzKSp.js";import"./VSlideGroup-CCtB-AAW.js";import"./filter-DTgM_L49.js";import"./index-CvOPxmL5.js";import"./VDataTable-DEOUo1va.js";import"./VTable-B6Lp1lU8.js";const Te={class:"d-flex flex-wrap gap-4 mx-5"},Ue={class:"flex-grow-1"},Ae={class:"d-flex gap-4"},Se={class:"custom-loader"},he={class:"text-end"},Be={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Me={class:"text-sm text-medium-emphasis mb-0"},Ie=["textContent"],Re={__name:"index",async setup(qe){let E,F;const y=s(null),_=s([]),T=s(8),u=s(1),D=s(0),p=s(!1),j=s(""),O=s(""),Q=s(""),z=s(),h=s(""),G=s(!1),v=s(!1),k=s(""),U=s("success"),A=s({});fe("userData");const ae=[{title:"Nom",key:"full_name"},{title:"Email",key:"email"},{title:"Téléphone",key:"mobile"},{title:"Profil",key:"profile_fr"},{title:"Actions",key:"actions",sortable:!1,align:"end"}],n=K({filter:{title:"Filtres"},data:{title:{singular:"Utilisateur",plural:"Utilisateurs"},actions:{singular:"l'utilisateur",plural:"les utilisateurs"},rule:{name:"user"},link:{base:"user"},api:{endPoint:"user",data:null,query:{}}}}),r=K([{view:{cols:{col:12,sm:12},name:{itemTitle:"name",itemValue:"id"}},base:{name:"Type",dataSource:"array",apiEndpoint:"user",query:{paginate:"false"}},filter:{key:"profile",value:null},api:{datac:[{id:"admin",name:"Administrateur"},{id:"agent",name:"Agent"},{id:"ministry",name:"Ministère"}]}}]),B={};for(let l=0;l<r.length;l++)if(r[l].base.data_source==="api"){const{data:e,execute:w}=([E,F]=ve(()=>Z(ee(`/${r[l].base.api_endpoint}`,{query:r[l].base.query}))),E=await E,F(),E);r[l].api.data=e,r[l].api.execute=w,r[l].api.datac=r[l].api.data.data,B[r[l].filter.key]=r[l].filter.value}const S=s({data:[],total:0,lastPage:1}),x=async(l=[])=>{l.forEach(e=>{_.value[e]=!0});try{const{data:e}=await Z(ee(n.data.api.endPoint,{query:{search:y.value,page:u.value,...n.data.api.query,...B}}));S.value=e.value}finally{l.forEach(e=>{_.value[e]=!1})}},le=R(()=>S.value.data),Y=R(()=>S.value.total),H=R(()=>S.value.lastPage),oe=l=>{u.value=l.page},ie=async l=>{A.value[l]=!0;try{const e=await ce(`${n.data.api.endPoint}/${l}`,{method:"DELETE"});if(e.status==200)v.value=!0,U.value="success",k.value=`${n.data.title.singular} supprimé avec succès`;else{U.value="error",v.value=!0,k.value="";for(const w in e.errors)e.errors[w].forEach(M=>{k.value+=""+M+"<br>"})}}catch{U.value="error",v.value=!0,k.value="Erreur lors de la suppression"}finally{A.value[l]=!1,await x()}};return ge(()=>{x([4])}),be([y,u],async()=>{await x([4])}),Ve(async()=>{r.forEach(l=>{B[l.filter.key]=l.filter.value}),await x([4])}),(l,e)=>{const w=pe,M=me,I=ye("IconBtn"),se=de,ne=ue;return c(),W("div",null,[a(L,{class:"mb-6"},{default:o(()=>[a(P,null,{default:o(()=>[a(te,null,{default:o(()=>[a(P,null,{default:o(()=>[d("h2",null,"Liste des "+$(n.data.title.plural),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(L,{title:n.filter.title,class:"mb-6"},{default:o(()=>[a(P,null,{default:o(()=>[a(te,null,{default:o(()=>[(c(!0),W(_e,null,ke(r,t=>(c(),g(we,{key:t.filter.key,cols:t.view.cols.col,sm:t.view.cols.sm??6},{default:o(()=>[a(w,{modelValue:t.filter.value,"onUpdate:modelValue":J=>t.filter.value=J,placeholder:t.base.name,"item-title":t.view.name.itemTitle??"name","item-value":t.view.name.itemValue??"id",items:t.api.datac,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","onUpdate:modelValue","placeholder","item-title","item-value","items"])]),_:2},1032,["cols","sm"]))),128))]),_:1}),a(N,{class:"my-4"})]),_:1}),d("div",Te,[d("div",Ue,[a(M,{modelValue:i(y),"onUpdate:modelValue":e[0]||(e[0]=t=>f(y)?y.value=t:null),placeholder:"Rechercher"},null,8,["modelValue"])]),d("div",Ae,[l.$can("create",n.data.rule.name)?(c(),g(b,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:`${n.data.link.base}-add`}},{default:o(()=>[...e[11]||(e[11]=[m(" Nouveau ",-1)])]),_:1},8,["to"])):C("",!0),a(b,{loading:i(_)[3],disabled:i(_)[3],"prepend-icon":"tabler-refresh",onClick:e[1]||(e[1]=t=>x([3,4]))},{loader:o(()=>[d("span",Se,[a(V,{icon:"tabler-refresh"})])]),default:o(()=>[e[12]||(e[12]=m(" Recharger ",-1))]),_:1},8,["loading","disabled"])])]),a(N,{class:"mt-4"}),a($e,{"items-per-page":i(T),"onUpdate:itemsPerPage":e[3]||(e[3]=t=>f(T)?T.value=t:null),page:i(u),"onUpdate:page":e[4]||(e[4]=t=>f(u)?u.value=t:null),loading:i(_)[4],headers:ae,items:i(le),"items-length":i(Y),class:"text-no-wrap","loading-text":"En cours de chargement","onUpdate:options":oe},{"item.actions":o(({item:t})=>[d("div",he,[d("div",null,[l.$can("read","ticket")?(c(),g(I,{key:0,to:{name:`${n.data.link.base}-id`,params:{id:t.id}}},{default:o(()=>[a(q,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:o(()=>[...e[13]||(e[13]=[m(" Details ",-1)])]),_:1}),a(V,{icon:"tabler-eye"})]),_:1},8,["to"])):C("",!0),l.$can("edit","ticket")?(c(),g(I,{key:1,to:{name:`${n.data.link.base}-edit-id`,params:{id:t.id}}},{default:o(()=>[a(q,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:o(()=>[...e[14]||(e[14]=[m(" Modifier ",-1)])]),_:1}),a(V,{icon:"tabler-edit"})]),_:1},8,["to"])):C("",!0),l.$can("delete","ticket")?(c(),g(I,{key:2,loading:i(A)[t.id],disabled:i(A)[t.id],onClick:J=>{D.value=t.id,j.value=`Supprimer ${n.data.actions.singular}`,O.value=`Voulez vous vraiment supprimer ${n.data.actions.singular}?`,z.value=ie,Q.value="Supprimer",G.value=!1,p.value=!0}},{default:o(()=>[a(V,{icon:"tabler-trash",color:"error"}),a(q,{activator:"parent",transition:"scroll-x-transition",location:"bottom"},{default:o(()=>[...e[15]||(e[15]=[m(" Supprimer ",-1)])]),_:1})]),_:1},8,["loading","disabled","onClick"])):C("",!0)])])]),bottom:o(()=>[a(N),d("div",Be,[d("p",Me,$(("paginationMeta"in l?l.paginationMeta:i(re))({page:i(u),itemsPerPage:i(T)},i(Y))),1),a(Ce,{modelValue:i(u),"onUpdate:modelValue":e[2]||(e[2]=t=>f(u)?u.value=t:null),length:i(H),"total-visible":l.$vuetify.display.xs?1:Math.min(i(H),5)},{prev:o(t=>[a(b,X({variant:"tonal",color:"default"},t,{icon:!1}),{default:o(()=>[a(V,{start:"",icon:"tabler-arrow-left"}),e[16]||(e[16]=m(" Précedent ",-1))]),_:1},16)]),next:o(t=>[a(b,X({variant:"tonal",color:"default"},t,{icon:!1}),{default:o(()=>[e[17]||(e[17]=m(" Suivant ",-1)),a(V,{end:"",icon:"tabler-arrow-right"})]),_:1},16)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","loading","items","items-length"])]),_:1},8,["title"]),a(Pe,{modelValue:i(p),"onUpdate:modelValue":e[9]||(e[9]=t=>f(p)?p.value=t:null),class:"v-dialog-sm"},{default:o(()=>[a(se,{onClick:e[5]||(e[5]=t=>p.value=!i(p))}),a(L,{title:i(j)},{default:o(()=>[a(P,null,{default:o(()=>[m($(i(O))+" ",1),i(G)?(c(),g(ne,{key:0,modelValue:i(h),"onUpdate:modelValue":e[6]||(e[6]=t=>f(h)?h.value=t:null),class:"mt-3",label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):C("",!0)]),_:1}),a(P,{class:"d-flex justify-end gap-3 flex-wrap"},{default:o(()=>[a(b,{color:"secondary",variant:"tonal",onClick:e[7]||(e[7]=t=>p.value=!1)},{default:o(()=>[...e[18]||(e[18]=[m(" Retour ",-1)])]),_:1}),a(b,{onClick:e[8]||(e[8]=t=>{i(z)(i(D)),p.value=!1})},{default:o(()=>[m($(i(Q)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),a(Ee,{modelValue:i(v),"onUpdate:modelValue":e[10]||(e[10]=t=>f(v)?v.value=t:null),transition:"scale-transition",location:"top end",color:i(U)},{default:o(()=>[d("div",{textContent:$(i(k))},null,8,Ie)]),_:1},8,["modelValue","color"])])}}},_t=xe(Re,[["__scopeId","data-v-1d570d8c"]]);export{_t as default};
