import{i as F,u as P,dE as k,bi as $,r as m,c as N,o as x,d as u,b as l,t as g,e as r,ah as V,s as h,F as S,h as T,f as U,_ as L,ba as A,b7 as M}from"./main-BZyHWxP-.js";import{_ as H}from"./FieldRenderer-ClWx76-A.js";import{u as I}from"./useApi-CqDIhdYp.js";import{c as R}from"./createUrl-RWZycZLg.js";import{$ as z}from"./api-0WedtC8c.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as w,a as _}from"./VRow-B20rruVT.js";import{V as J}from"./VCard-BHQDPESW.js";import{V as K}from"./VCardText-CmyiQv4t.js";import{V as O}from"./VForm-BpUU7xqx.js";import{V as Q}from"./VSnackbar-r55CRLic.js";import"./AppDateTimePicker-Bt5bw6tg.js";import"./VField-CoXLbqml.js";import"./TiptapEditor-DOeDfFDI.js";import"./index-C3nn1atq.js";import"./index-Dxkci4Dk.js";import"./VDivider-CktbFQ7a.js";import"./validators-DpYrMFzk.js";import"./helpers-DK5QwNv0.js";import"./VTextField-BzLGB-co.js";import"./autofocus-DThxoTWr.js";import"./VCounter-D2PtsxdL.js";import"./VTextarea-DciDp74g.js";import"./VAutocomplete-akOlU6OV.js";import"./VSelect-CI_o2-A6.js";import"./VList-DbFeSWDW.js";import"./ssrBoot-DURCToRA.js";import"./VAvatar-8Zwc_tqP.js";import"./VCheckboxBtn-qZOqlrBl.js";import"./VSelectionControl-DwoCMlaG.js";import"./VChip-CeQObjZq.js";import"./VSlideGroup-CbdWe5cW.js";import"./filter-Da5uf3G2.js";import"./VSwitch-DLSIbHZW.js";import"./VFileInput-B00mRcAE.js";import"./index-CvOPxmL5.js";const W={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},X={class:"d-flex flex-column justify-center"},Y={class:"text-h4 font-weight-medium"},Z={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},ee={class:"d-flex gap-4 align-center flex-wrap"},ae=["innerHTML"],te={__name:"[id]",async setup(le){let i,p;const j=F(),q=P(),v=k({api:{endPoint:"incident",itemName:"Incident",query:{}}}),s=k({name:"Incidents",backName:"un",secondBackName:"le",backRoute:{name:"Incidents",endPoint:"incident"},api:{isLoading:!1}}),{data:B}=([i,p]=$(()=>I(R(`/${v.api.endPoint}/${q.params.id}`,{query:v.api.query}))),i=await i,p(),i),n=m(B.value.data[v.api.itemName]),y={api:{endpoint:"incident",method:"PUT"},backRouteName:"incident"};function D(){o.forEach(e=>{e.errors=null})}const o=k([{type:"text",label:"titre",value_key:"title",default_value:"incendie",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6}},{type:"lov",label:"Localisation",default_value:null,value_key:"location_id",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6},data:{list:{id:"id",name:"name",source:"api",api:{endpoint:"location",query:{},execute:null,data:null},items:[],multiple:!1}}},{type:"text",label:"Personnes impliquées",value_key:"people_involved",default_value:null,errors:null,required:!1,cols:{cols:12,sm:12,md:12,lg:12}},{type:"date",label:"Date de l'incident",value_key:"occurred_at",default_value:null,errors:null,required:!0,cols:{cols:12,sm:12,md:12,lg:12}},{type:"textarea",label:"Description",value_key:"description",errors:null,required:!0,default_value:"test",cols:{cols:12,sm:12,md:12,lg:12}},{type:"textarea",label:"Actions prises",value_key:"actions_taken",errors:null,required:!1,default_value:"test",cols:{cols:12,sm:12,md:12,lg:12}}]);for(let e=0;e<o.length;e++)if(o[e].type==="lov"&&o[e].data.list.source==="api"){const{data:a,execute:t}=([i,p]=$(()=>I(R(`/${o[e].data.list.api.endpoint}`,{query:o[e].data.list.api.query}))),i=await i,p(),i);o[e].data.list.api.data=a,o[e].data.list.api.execute=t,o[e].data.list.items=o[e].data.list.api.data.data}n.value&&Array.isArray(n.value.users)&&(n.value.users=n.value.users.map(e=>typeof e=="object"&&e!==null?e.id:e));const b=m(),E=()=>{b.value?.validate().then(async({valid:e})=>{if(s.api.isLoading=!0,e){D();const a=await z(`/${y.api.endpoint}/${q.params.id}`,{method:y.api.method,body:n.value});if(a?.status==200)d.value=`${s.name} modifié avec succès`,f.value="success",c.value=!0,j.push({name:y.backRouteName});else if(a?.errors){o.forEach(t=>{a.errors[t.value_key]&&(t.errors=a.errors[t.value_key])}),d.value="";for(const t in a.errors)a.errors[t]&&(d.value+=`${a.errors[t]}`);f.value="error",c.value=!!d.value}else d.value=a?.message??"Une erreur inconnue est survenue.",f.value="error",c.value=!0;M(()=>{b.value?.resetValidation()})}s.api.isLoading=!1})},c=m(!1),d=m(""),f=m("success");return(e,a)=>(x(),N("div",null,[u("div",W,[u("div",X,[u("h4",Y," Modifier "+g(s.backName)+" "+g(s.name),1)])]),l(O,{ref_key:"refForm",ref:b,onSubmit:A(E,["prevent"])},{default:r(()=>[l(w,null,{default:r(()=>[l(_,{cols:"11"},{default:r(()=>[l(V,{"prepend-icon":"tabler-arrow-narrow-left",to:{name:s.backRoute.endPoint}},{default:r(()=>[h(g(s.backRoute.name),1)]),_:1},8,["to"])]),_:1})]),_:1}),l(w,null,{default:r(()=>[l(_,{md:"12"},{default:r(()=>[l(J,{class:"mb-6",title:`Informations sur ${s.secondBackName} ${s.name}`},{default:r(()=>[l(K,null,{default:r(()=>[l(w,null,{default:r(()=>[(x(!0),N(S,null,T(o,t=>(x(),U(_,{key:t.value_key,cols:t.cols.cols??12,sm:t.cols.sm??12,md:t.cols.md??12,lg:t.cols.lg??12},{default:r(()=>[l(H,{modelValue:n.value[t.value_key],"onUpdate:modelValue":C=>n.value[t.value_key]=C,field:t},null,8,["modelValue","onUpdate:modelValue","field"])]),_:2},1032,["cols","sm","md","lg"]))),128))]),_:1})]),_:1})]),_:1},8,["title"])]),_:1}),l(_,{cols:"12"},{default:r(()=>[u("div",Z,[a[3]||(a[3]=u("div",{class:"d-flex flex-column justify-center"},null,-1)),u("div",ee,[l(V,{type:"reset",variant:"tonal",color:"primary"},{default:r(()=>[l(L,{start:"",icon:"tabler-circle-minus"}),a[1]||(a[1]=h(" Effacer ",-1))]),_:1}),l(V,{type:"submit",class:"me-3",loading:s.api.isLoading,disabled:s.api.isLoading},{default:r(()=>[a[2]||(a[2]=h(" Enregistrer ",-1)),l(L,{end:"",icon:"tabler-checkbox"})]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1})]),_:1},512),l(Q,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t),transition:"scale-transition",location:"top end",color:f.value},{default:r(()=>[u("div",{innerHTML:d.value},null,8,ae)]),_:1},8,["modelValue","color"])]))}},Ue=G(te,[["__scopeId","data-v-19ea7608"]]);export{Ue as default};
