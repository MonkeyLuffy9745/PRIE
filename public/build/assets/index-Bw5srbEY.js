import{p as re}from"./paginationMeta-DF6W6vpY.js";import{_ as ue}from"./AppTextarea-Byp6ONd4.js";import{_ as de}from"./DialogCloseBtn-D3xd3JNr.js";import{_ as me}from"./AppTextField-Dhk438H7.js";import{_ as pe}from"./AppAutocomplete-CWRtlt6e.js";import{$ as ce}from"./api-0WedtC8c.js";import{r as s,bd as fe,dE as K,bi as ve,Y as R,E as ge,w as be,bO as Ve,a as ye,c as W,o as c,b as t,e as o,d,t as $,F as _e,h as ke,f as g,b1 as f,l as i,k as C,ah as b,s as m,_ as V,p as X,b8 as q}from"./main-BZyHWxP-.js";import{u as Z}from"./useApi-CqDIhdYp.js";import{c as ee}from"./createUrl-RWZycZLg.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as P}from"./VCardText-CmyiQv4t.js";import{V as ae,a as we}from"./VRow-B20rruVT.js";import{V as L}from"./VCard-BHQDPESW.js";import{V as N}from"./VDivider-CktbFQ7a.js";import{V as $e}from"./VDataTableServer-B8prfqHZ.js";import{V as Ce}from"./VPagination-BafHFDao.js";import{V as Pe}from"./VDialog-7WxpKhhh.js";import{V as Ee}from"./VSnackbar-r55CRLic.js";import"./VTextarea-DciDp74g.js";import"./autofocus-DThxoTWr.js";import"./VCounter-D2PtsxdL.js";import"./VField-CoXLbqml.js";import"./VTextField-BzLGB-co.js";import"./VAutocomplete-akOlU6OV.js";import"./VSelect-CI_o2-A6.js";import"./VList-DbFeSWDW.js";import"./ssrBoot-DURCToRA.js";import"./VAvatar-8Zwc_tqP.js";import"./VCheckboxBtn-qZOqlrBl.js";import"./VSelectionControl-DwoCMlaG.js";import"./VChip-CeQObjZq.js";import"./VSlideGroup-CbdWe5cW.js";import"./filter-Da5uf3G2.js";import"./index-CvOPxmL5.js";import"./VDataTable-CLMWV4tH.js";import"./VTable-Bfxydk3f.js";const Te={class:"d-flex flex-wrap gap-4 mx-5"},Ue={class:"flex-grow-1"},Ae={class:"d-flex gap-4"},Se={class:"custom-loader"},he={class:"text-end"},Be={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Me={class:"text-sm text-medium-emphasis mb-0"},Ie=["textContent"],Re={__name:"index",async setup(qe){let E,F;const y=s(null),_=s([]),T=s(8),u=s(1),D=s(0),p=s(!1),j=s(""),O=s(""),Q=s(""),z=s(),h=s(""),Y=s(!1),v=s(!1),k=s(""),U=s("success"),A=s({});fe("userData");const te=[{title:"Nom",key:"full_name"},{title:"Email",key:"email"},{title:"Téléphone",key:"mobile"},{title:"Profil",key:"profile_fr"},{title:"Actions",key:"actions",sortable:!1,align:"end"}],n=K({filter:{title:"Filtres"},data:{title:{singular:"Utilisateur",plural:"Utilisateurs"},actions:{singular:"l'utilisateur",plural:"les utilisateurs"},rule:{name:"user"},link:{base:"user"},api:{endPoint:"user",data:null,query:{}}}}),r=K([{view:{cols:{col:12,sm:12},name:{itemTitle:"name",itemValue:"id"}},base:{name:"Type",dataSource:"array",apiEndpoint:"user",query:{paginate:"false"}},filter:{key:"profile",value:null},api:{datac:[{id:"admin",name:"Administrateur"},{id:"agent",name:"Agent"},{id:"ministry",name:"Ministère"}]}}]),B={};for(let l=0;l<r.length;l++)if(r[l].base.data_source==="api"){const{data:e,execute:w}=([E,F]=ve(()=>Z(ee(`/${r[l].base.api_endpoint}`,{query:r[l].base.query}))),E=await E,F(),E);r[l].api.data=e,r[l].api.execute=w,r[l].api.datac=r[l].api.data.data,B[r[l].filter.key]=r[l].filter.value}const S=s({data:[],total:0,lastPage:1}),x=async(l=[])=>{l.forEach(e=>{_.value[e]=!0});try{const{data:e}=await Z(ee(n.data.api.endPoint,{query:{search:y.value,page:u.value,...n.data.api.query,...B}}));S.value=e.value}finally{l.forEach(e=>{_.value[e]=!1})}},le=R(()=>S.value.data),G=R(()=>S.value.total),H=R(()=>S.value.lastPage),oe=l=>{u.value=l.page},ie=async l=>{A.value[l]=!0;try{const e=await ce(`${n.data.api.endPoint}/${l}`,{method:"DELETE"});if(e.status==200)v.value=!0,U.value="success",k.value=`${n.data.title.singular} supprimé avec succès`;else{U.value="error",v.value=!0,k.value="";for(const w in e.errors)e.errors[w].forEach(M=>{k.value+=""+M+"<br>"})}}catch{U.value="error",v.value=!0,k.value="Erreur lors de la suppression"}finally{A.value[l]=!1,await x()}};return ge(()=>{x([4])}),be([y,u],async()=>{await x([4])}),Ve(async()=>{r.forEach(l=>{B[l.filter.key]=l.filter.value}),await x([4])}),(l,e)=>{const w=pe,M=me,I=ye("IconBtn"),se=de,ne=ue;return c(),W("div",null,[t(L,{class:"mb-6"},{default:o(()=>[t(P,null,{default:o(()=>[t(ae,null,{default:o(()=>[t(P,null,{default:o(()=>[d("h2",null,"Liste des "+$(n.data.title.plural),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(L,{title:n.filter.title,class:"mb-6"},{default:o(()=>[t(P,null,{default:o(()=>[t(ae,null,{default:o(()=>[(c(!0),W(_e,null,ke(r,a=>(c(),g(we,{key:a.filter.key,cols:a.view.cols.col,sm:a.view.cols.sm??6},{default:o(()=>[t(w,{modelValue:a.filter.value,"onUpdate:modelValue":J=>a.filter.value=J,placeholder:a.base.name,"item-title":a.view.name.itemTitle??"name","item-value":a.view.name.itemValue??"id",items:a.api.datac,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","onUpdate:modelValue","placeholder","item-title","item-value","items"])]),_:2},1032,["cols","sm"]))),128))]),_:1}),t(N,{class:"my-4"})]),_:1}),d("div",Te,[d("div",Ue,[t(M,{modelValue:i(y),"onUpdate:modelValue":e[0]||(e[0]=a=>f(y)?y.value=a:null),placeholder:"Rechercher"},null,8,["modelValue"])]),d("div",Ae,[l.$can("create",n.data.rule.name)?(c(),g(b,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:`${n.data.link.base}-add`}},{default:o(()=>[...e[11]||(e[11]=[m(" Nouveau ",-1)])]),_:1},8,["to"])):C("",!0),t(b,{loading:i(_)[3],disabled:i(_)[3],"prepend-icon":"tabler-refresh",onClick:e[1]||(e[1]=a=>x([3,4]))},{loader:o(()=>[d("span",Se,[t(V,{icon:"tabler-refresh"})])]),default:o(()=>[e[12]||(e[12]=m(" Recharger ",-1))]),_:1},8,["loading","disabled"])])]),t(N,{class:"mt-4"}),t($e,{"items-per-page":i(T),"onUpdate:itemsPerPage":e[3]||(e[3]=a=>f(T)?T.value=a:null),page:i(u),"onUpdate:page":e[4]||(e[4]=a=>f(u)?u.value=a:null),loading:i(_)[4],headers:te,items:i(le),"items-length":i(G),class:"text-no-wrap","loading-text":"En cours de chargement","onUpdate:options":oe},{"item.actions":o(({item:a})=>[d("div",he,[d("div",null,[l.$can("read","user")?(c(),g(I,{key:0,to:{name:`${n.data.link.base}-id`,params:{id:a.id}}},{default:o(()=>[t(q,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:o(()=>[...e[13]||(e[13]=[m(" Details ",-1)])]),_:1}),t(V,{icon:"tabler-eye"})]),_:1},8,["to"])):C("",!0),l.$can("edit","user")?(c(),g(I,{key:1,to:{name:`${n.data.link.base}-edit-id`,params:{id:a.id}}},{default:o(()=>[t(q,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:o(()=>[...e[14]||(e[14]=[m(" Modifier ",-1)])]),_:1}),t(V,{icon:"tabler-edit"})]),_:1},8,["to"])):C("",!0),l.$can("delete","user")?(c(),g(I,{key:2,loading:i(A)[a.id],disabled:i(A)[a.id],onClick:J=>{D.value=a.id,j.value=`Supprimer ${n.data.actions.singular}`,O.value=`Voulez vous vraiment supprimer ${n.data.actions.singular}?`,z.value=ie,Q.value="Supprimer",Y.value=!1,p.value=!0}},{default:o(()=>[t(V,{icon:"tabler-trash",color:"error"}),t(q,{activator:"parent",transition:"scroll-x-transition",location:"bottom"},{default:o(()=>[...e[15]||(e[15]=[m(" Supprimer ",-1)])]),_:1})]),_:1},8,["loading","disabled","onClick"])):C("",!0)])])]),bottom:o(()=>[t(N),d("div",Be,[d("p",Me,$(("paginationMeta"in l?l.paginationMeta:i(re))({page:i(u),itemsPerPage:i(T)},i(G))),1),t(Ce,{modelValue:i(u),"onUpdate:modelValue":e[2]||(e[2]=a=>f(u)?u.value=a:null),length:i(H),"total-visible":l.$vuetify.display.xs?1:Math.min(i(H),5)},{prev:o(a=>[t(b,X({variant:"tonal",color:"default"},a,{icon:!1}),{default:o(()=>[t(V,{start:"",icon:"tabler-arrow-left"}),e[16]||(e[16]=m(" Précedent ",-1))]),_:1},16)]),next:o(a=>[t(b,X({variant:"tonal",color:"default"},a,{icon:!1}),{default:o(()=>[e[17]||(e[17]=m(" Suivant ",-1)),t(V,{end:"",icon:"tabler-arrow-right"})]),_:1},16)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","loading","items","items-length"])]),_:1},8,["title"]),t(Pe,{modelValue:i(p),"onUpdate:modelValue":e[9]||(e[9]=a=>f(p)?p.value=a:null),class:"v-dialog-sm"},{default:o(()=>[t(se,{onClick:e[5]||(e[5]=a=>p.value=!i(p))}),t(L,{title:i(j)},{default:o(()=>[t(P,null,{default:o(()=>[m($(i(O))+" ",1),i(Y)?(c(),g(ne,{key:0,modelValue:i(h),"onUpdate:modelValue":e[6]||(e[6]=a=>f(h)?h.value=a:null),class:"mt-3",label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):C("",!0)]),_:1}),t(P,{class:"d-flex justify-end gap-3 flex-wrap"},{default:o(()=>[t(b,{color:"secondary",variant:"tonal",onClick:e[7]||(e[7]=a=>p.value=!1)},{default:o(()=>[...e[18]||(e[18]=[m(" Retour ",-1)])]),_:1}),t(b,{onClick:e[8]||(e[8]=a=>{i(z)(i(D)),p.value=!1})},{default:o(()=>[m($(i(Q)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),t(Ee,{modelValue:i(v),"onUpdate:modelValue":e[10]||(e[10]=a=>f(v)?v.value=a:null),transition:"scale-transition",location:"top end",color:i(U)},{default:o(()=>[d("div",{textContent:$(i(k))},null,8,Ie)]),_:1},8,["modelValue","color"])])}}},_a=xe(Re,[["__scopeId","data-v-02a3cbb4"]]);export{_a as default};
