import{r as _,e as F}from"./validators-DpYrMFzk.js";import{r as i,u as M,i as D,c as N,o as E,b as r,e as l,d as m,b9 as h,l as a,G as y,s as c,t as k,ba as $,ah as j,b1 as A,F as U,bd as g,b7 as z}from"./main-BZyHWxP-.js";import{_ as G}from"./AppTextField-Dhk438H7.js";import{u as x}from"./useGenerateImageVariant-7lNlSnR7.js";import{a as P,b as O,c as H,d as J}from"./auth-v2-login-illustration-light-CZAH_Qyi.js";import{a as K,b as Q}from"./misc-mask-light-Ha4lQOdV.js";import{V as W}from"./VNodeRenderer-DvfyyJuI.js";import{u as X}from"./useAbility-Jt_lEerw.js";import{$ as Y}from"./api-0WedtC8c.js";import{a as V,V as T}from"./VRow-B20rruVT.js";import{V as Z}from"./VCard-BHQDPESW.js";import{V as C}from"./VCardText-CmyiQv4t.js";import{V as ee}from"./VForm-BpUU7xqx.js";import{V as ae}from"./VSnackbar-r55CRLic.js";import"./helpers-DK5QwNv0.js";import"./VTextField-BzLGB-co.js";import"./autofocus-DThxoTWr.js";import"./VCounter-D2PtsxdL.js";import"./VField-CoXLbqml.js";import"./index-CvOPxmL5.js";import"./VAvatar-8Zwc_tqP.js";const se={class:"position-relative bg-background rounded-lg w-100 ma-8 me-0"},re={class:"d-flex align-center justify-center w-100 h-100"},oe={class:"text-h4 mb-1"},le={class:"text-capitalize"},Le={__name:"login",setup(te){const I=x(J,H,O,P,!0),L=x(Q,K),d=i(!1),p=i(!1),v=M(),R=D(),S=X(),t=i({email:void 0,password:void 0}),w=i(),n=i({email:"test@example.com",password:"password"}),q=async()=>{d.value=!0;try{const s=await Y("/auth/login",{method:"POST",body:{email:n.value.email,password:n.value.password},onResponseError({response:e}){t.value=e._data.errors}});if(t.value.email=void 0,t.value.password=void 0,s.status==200){const{userToken:e,user:o}=s.data;console.log(o),g("userAbilityRules").value=o.ability_rules,S.update(o.ability_rules),g("userData").value={id:o.id,fullName:o.name,username:o.name,avatar:"/images/avatars/avatar-1.png",email:o.email,role:o.profile,role_fr:o.profile_fr,flexcube_user_id:o.flexcube_user_id,climbing_level:o.climbing_level},g("accessToken").value=e,await z(()=>{R.replace(v.query.to?String(v.query.to):"/")})}else if(s.status!=200)if(s.errors.email)t.value.email=s.errors.email[0];else if(s.errors.password)t.value.password=s.errors.password[0];else{f.value=!0,b.value="";for(const e in s.errors)e!="sub_code"&&s.errors[e].forEach(o=>{b.value+=o+`
`})}}catch(s){d.value=!1,console.error(s)}d.value=!1},B=()=>{w.value?.validate().then(({valid:s})=>{s&&q()})},f=i(!1),b=i("");return(s,e)=>{const o=G;return E(),N(U,null,[r(T,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:l(()=>[r(V,{lg:"8",class:"d-none d-lg-flex"},{default:l(()=>[m("div",se,[m("div",re,[r(h,{"max-width":"505",src:a(I),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),r(h,{src:a(L),class:"auth-footer-mask"},null,8,["src"])])]),_:1}),r(V,{cols:"12",lg:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:l(()=>[r(Z,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:l(()=>[r(C,null,{default:l(()=>[r(a(W),{nodes:a(y).app.logo,class:"mb-6"},null,8,["nodes"]),m("h4",oe,[e[4]||(e[4]=c(" Bienvenue sur ",-1)),m("span",le,k(a(y).app.title),1),e[5]||(e[5]=c("!  ",-1))]),e[6]||(e[6]=m("p",{class:"mb-0"}," Veuillez vous connecter ",-1))]),_:1}),r(C,null,{default:l(()=>[r(a(ee),{ref_key:"refVForm",ref:w,onSubmit:$(B,["prevent"])},{default:l(()=>[r(T,null,{default:l(()=>[r(V,{cols:"12"},{default:l(()=>[r(o,{modelValue:a(n).email,"onUpdate:modelValue":e[0]||(e[0]=u=>a(n).email=u),label:"Email",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in s?s.requiredValidator:a(_),"emailValidator"in s?s.emailValidator:a(F)],"error-messages":a(t).email},null,8,["modelValue","rules","error-messages"])]),_:1}),r(V,{cols:"12"},{default:l(()=>[r(o,{modelValue:a(n).password,"onUpdate:modelValue":e[1]||(e[1]=u=>a(n).password=u),label:"Mot de passe",placeholder:"路路路路路路路路路路路路",rules:["requiredValidator"in s?s.requiredValidator:a(_)],type:a(p)?"text":"password","error-messages":a(t).password,"append-inner-icon":a(p)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=u=>p.value=!a(p)),class:"mb-8"},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),r(j,{block:"",type:"submit",loading:a(d),disabled:a(d)},{default:l(()=>[...e[7]||(e[7]=[c("Connexion",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),r(ae,{modelValue:a(f),"onUpdate:modelValue":e[3]||(e[3]=u=>A(f)?f.value=u:null),transition:"scroll-y-reverse-transition",location:"bottom end",color:"error"},{default:l(()=>[c(k(a(b)),1)]),_:1},8,["modelValue"])],64)}}};export{Le as default};
