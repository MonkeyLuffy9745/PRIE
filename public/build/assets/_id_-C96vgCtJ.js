import{i as M,u as P,dG as g,bi as q,r as c,c as N,o as k,d as n,b as r,t as x,e as s,ah as V,s as h,F as A,h as C,f as F,_ as $,ba as I,b7 as D}from"./main-B_3U4rnL.js";import{_ as H}from"./FieldRenderer-BkYsa3Yc.js";import{u as E}from"./useApi-2ULgWkV5.js";import{c as L}from"./createUrl-DSuaXwyR.js";import{$ as G}from"./api-CXpAJbKn.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as w,a as _}from"./VRow-rSP3UPT0.js";import{V as J}from"./VCard-CHvE1CVF.js";import{V as K}from"./VCardText-CbE5M2-5.js";import{V as O}from"./VForm-CjsMgpeM.js";import{V as Q}from"./VSnackbar-XjXLO0OV.js";import"./AppDateTimePicker-C5PQHceF.js";import"./VField-3YJ8FXmc.js";import"./TiptapEditor-R1VBqz69.js";import"./index-CC9o5_Jl.js";import"./index-DzVQabXu.js";import"./VDivider-CHuFBZ5S.js";import"./validators-DpYrMFzk.js";import"./helpers-DK5QwNv0.js";import"./VTextField-eMdtVNtb.js";import"./autofocus-Bw9dR2w9.js";import"./VCounter-D_guRIhI.js";import"./VTextarea-hCZEX-uB.js";import"./VAutocomplete-B6b0HexW.js";import"./VSelect-DQ-4196m.js";import"./VList-Ce9acDAh.js";import"./ssrBoot-DCfCAOKs.js";import"./VAvatar-K7hB1Kku.js";import"./VCheckboxBtn-DobkZaJy.js";import"./VSelectionControl-DLNDeEFn.js";import"./VChip-BAqKzKSp.js";import"./VSlideGroup-CCtB-AAW.js";import"./filter-DTgM_L49.js";import"./VSwitch-Dky9GR1R.js";import"./VFileInput-QALlyd5V.js";import"./index-CvOPxmL5.js";const W={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},X={class:"d-flex flex-column justify-center"},Y={class:"text-h4 font-weight-medium"},Z={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},ee={class:"d-flex gap-4 align-center flex-wrap"},ae=["innerHTML"],te={__name:"[id]",async setup(re){let i,p;const R=M(),T=P(),v=g({api:{endPoint:"user",itemName:"User",query:{}}}),o=g({name:"Utilisateurs",backName:"un",secondBackName:"le",backRoute:{name:"Utilisateurs",endPoint:"user"},api:{isLoading:!1}}),{data:S}=([i,p]=q(()=>E(L(`/${v.api.endPoint}/${T.params.id}`,{query:v.api.query}))),i=await i,p(),i),u=c(S.value.data[v.api.itemName]),y={api:{endpoint:"user",method:"PUT"},backRouteName:"user"};function U(){l.forEach(e=>{e.errors=null})}const l=g([{type:"text",label:"Nom",value_key:"first_name",default_value:"TEST",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6}},{type:"text",label:"Prénom",value_key:"last_name",default_value:"TEST",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6}},{type:"text",label:"Email",default_value:"TEST@gmail.com",value_key:"email",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6}},{type:"text",label:"Téléphone",value_key:"mobile",default_value:"91611135",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6}},{type:"lov",label:"Profil",value_key:"profile",errors:null,required:!0,default_value:"test",cols:{cols:12,sm:6,md:6,lg:6},data:{list:{id:"id",name:"name",source:"array",api:{endpoint:null,query:{},execute:null,data:null},items:[{id:"admin",name:"Administrateur"},{id:"agent",name:"Agent"},{id:"ministry",name:"Ministère"}],multiple:!1}}},{type:"text",label:"Mot de passe",value_key:"password",errors:null,required:!1,default_value:"testtest",cols:{cols:12,sm:6,md:6,lg:6}}]);for(let e=0;e<l.length;e++)if(l[e].type==="lov"&&l[e].data.list.source==="api"){const{data:a,execute:t}=([i,p]=q(()=>E(L(`/${l[e].data.list.api.endpoint}`,{query:l[e].data.list.api.query}))),i=await i,p(),i);l[e].data.list.api.data=a,l[e].data.list.api.execute=t,l[e].data.list.items=l[e].data.list.api.data.data}u.value&&Array.isArray(u.value.users)&&(u.value.users=u.value.users.map(e=>typeof e=="object"&&e!==null?e.id:e));const b=c(),j=()=>{b.value?.validate().then(async({valid:e})=>{if(o.api.isLoading=!0,e){U();const a=await G(`/${y.api.endpoint}/${T.params.id}`,{method:y.api.method,body:u.value});if(a?.status==200)m.value=`${o.name} modifié avec succès`,f.value="success",d.value=!0,R.push({name:y.backRouteName});else if(a?.errors){l.forEach(t=>{a.errors[t.value_key]&&(t.errors=a.errors[t.value_key])}),m.value="";for(const t in a.errors)a.errors[t]&&(m.value+=`${a.errors[t]}`);f.value="error",d.value=!!m.value}else m.value=a?.message??"Une erreur inconnue est survenue.",f.value="error",d.value=!0;D(()=>{b.value?.resetValidation()})}o.api.isLoading=!1})},d=c(!1),m=c(""),f=c("success");return(e,a)=>(k(),N("div",null,[n("div",W,[n("div",X,[n("h4",Y," Modifier "+x(o.backName)+" "+x(o.name),1)])]),r(O,{ref_key:"refForm",ref:b,onSubmit:I(j,["prevent"])},{default:s(()=>[r(w,null,{default:s(()=>[r(_,{cols:"11"},{default:s(()=>[r(V,{"prepend-icon":"tabler-arrow-narrow-left",to:{name:o.backRoute.endPoint}},{default:s(()=>[h(x(o.backRoute.name),1)]),_:1},8,["to"])]),_:1})]),_:1}),r(w,null,{default:s(()=>[r(_,{md:"12"},{default:s(()=>[r(J,{class:"mb-6",title:`Informations sur ${o.secondBackName} ${o.name}`},{default:s(()=>[r(K,null,{default:s(()=>[r(w,null,{default:s(()=>[(k(!0),N(A,null,C(l,t=>(k(),F(_,{key:t.value_key,cols:t.cols.cols??12,sm:t.cols.sm??12,md:t.cols.md??12,lg:t.cols.lg??12},{default:s(()=>[r(H,{modelValue:u.value[t.value_key],"onUpdate:modelValue":B=>u.value[t.value_key]=B,field:t},null,8,["modelValue","onUpdate:modelValue","field"])]),_:2},1032,["cols","sm","md","lg"]))),128))]),_:1})]),_:1})]),_:1},8,["title"])]),_:1}),r(_,{cols:"12"},{default:s(()=>[n("div",Z,[a[3]||(a[3]=n("div",{class:"d-flex flex-column justify-center"},null,-1)),n("div",ee,[r(V,{type:"reset",variant:"tonal",color:"primary"},{default:s(()=>[r($,{start:"",icon:"tabler-circle-minus"}),a[1]||(a[1]=h(" Effacer ",-1))]),_:1}),r(V,{type:"submit",class:"me-3",loading:o.api.isLoading,disabled:o.api.isLoading},{default:s(()=>[a[2]||(a[2]=h(" Enregistrer ",-1)),r($,{end:"",icon:"tabler-checkbox"})]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1})]),_:1},512),r(Q,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=t=>d.value=t),transition:"scale-transition",location:"top end",color:f.value},{default:s(()=>[n("div",{innerHTML:m.value},null,8,ae)]),_:1},8,["modelValue","color"])]))}},Fe=z(te,[["__scopeId","data-v-ca4646d5"]]);export{Fe as default};
