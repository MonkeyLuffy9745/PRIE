import{p as re}from"./paginationMeta-DF6W6vpY.js";import{_ as ue}from"./AppTextarea-D7ChMIYv.js";import{_ as de}from"./DialogCloseBtn-DFQkjJSZ.js";import{_ as me}from"./AppTextField-CP55am0g.js";import{_ as pe}from"./AppAutocomplete-Dx7JPk9j.js";import{$ as ce}from"./api-N0CH2dad.js";import{r as n,bd as fe,dE as K,bi as ve,Y as I,E as ge,w as Ve,bO as be,a as ye,c as W,o as c,b as t,e as o,d,t as $,F as _e,h as ke,f as g,b1 as f,l as i,k as C,ah as V,s as m,_ as b,p as X,b8 as M}from"./main-BEYAFsWY.js";import{u as Z}from"./useApi-DL_wWqQ9.js";import{c as ee}from"./createUrl-CNJYluNR.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as P}from"./VCardText-BoDvIV3o.js";import{V as ae,a as we}from"./VRow-DhucUJ_c.js";import{V as N}from"./VCard-DAB_Bu5L.js";import{V as q}from"./VDivider-CFXljG1d.js";import{V as $e}from"./VDataTableServer-BhPmqj1t.js";import{V as Ce}from"./VPagination-WiSBs5bf.js";import{V as Pe}from"./VDialog-BkOJSaE5.js";import{V as Ee}from"./VSnackbar-ChDeThqV.js";import"./VTextarea-B7IpR3s5.js";import"./autofocus-sxRgyBjq.js";import"./VCounter-CG_HpDHy.js";import"./VField-9ku5YizL.js";import"./VTextField-Dp2G28tr.js";import"./VAutocomplete-BLVUhDue.js";import"./VSelect-BCqqkMkZ.js";import"./VList-BOjC5y0z.js";import"./ssrBoot-CAyz4zn7.js";import"./VAvatar-B5UblNHH.js";import"./VCheckboxBtn-Civ28FTj.js";import"./VSelectionControl-Dq5wMchr.js";import"./VChip-DQe73DDG.js";import"./VSlideGroup-CcoO5AYH.js";import"./filter-CZ8mmpcR.js";import"./index-CvOPxmL5.js";import"./VDataTable-BkrQF0Ii.js";import"./VTable-ldYwifqa.js";const Te={class:"d-flex flex-wrap gap-4 mx-5"},Se={class:"flex-grow-1"},Ue={class:"d-flex gap-4"},Ae={class:"custom-loader"},he={class:"text-end"},Be={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Le={class:"text-sm text-medium-emphasis mb-0"},Re=["textContent"],Ie={__name:"index",async setup(Me){let E,F;const y=n(null),_=n([]),T=n(8),u=n(1),D=n(0),p=n(!1),j=n(""),O=n(""),Q=n(""),z=n(),h=n(""),Y=n(!1),v=n(!1),k=n(""),S=n("success"),U=n({});fe("userData");const te=[{title:"Nom",key:"name"},{title:"Niveau",key:"level_fr"},{title:"Parent",key:"parent.name"},{title:"Actions",key:"actions",sortable:!1,align:"end"}],s=K({filter:{title:"Filtres"},data:{title:{singular:"Localisation",plural:"Localisations"},actions:{singular:"la localisation",plural:"les localisations"},rule:{name:"location"},link:{base:"location"},api:{endPoint:"location",data:null,query:{}}}}),r=K([{view:{cols:{col:12,sm:12},name:{itemTitle:"name",itemValue:"id"}},base:{name:"Type",dataSource:"array",apiEndpoint:"location",query:{paginate:"false"}},filter:{key:"profile",value:null},api:{datac:[{id:"region",name:"Région"},{id:"prefecture",name:"Préfecture"}]}}]),B={with_parent:"true"};for(let l=0;l<r.length;l++)if(r[l].base.data_source==="api"){const{data:e,execute:w}=([E,F]=ve(()=>Z(ee(`/${r[l].base.api_endpoint}`,{query:r[l].base.query}))),E=await E,F(),E);r[l].api.data=e,r[l].api.execute=w,r[l].api.datac=r[l].api.data.data,B[r[l].filter.key]=r[l].filter.value}const A=n({data:[],total:0,lastPage:1}),x=async(l=[])=>{l.forEach(e=>{_.value[e]=!0});try{const{data:e}=await Z(ee(s.data.api.endPoint,{query:{search:y.value,page:u.value,...s.data.api.query,...B}}));A.value=e.value}finally{l.forEach(e=>{_.value[e]=!1})}},le=I(()=>A.value.data),G=I(()=>A.value.total),H=I(()=>A.value.lastPage),oe=l=>{u.value=l.page},ie=async l=>{U.value[l]=!0;try{const e=await ce(`${s.data.api.endPoint}/${l}`,{method:"DELETE"});if(e.status==200)v.value=!0,S.value="success",k.value=`${s.data.title.singular} supprimé avec succès`;else{S.value="error",v.value=!0,k.value="";for(const w in e.errors)e.errors[w].forEach(L=>{k.value+=""+L+"<br>"})}}catch{S.value="error",v.value=!0,k.value="Erreur lors de la suppression"}finally{U.value[l]=!1,await x()}};return ge(()=>{x([4])}),Ve([y,u],async()=>{await x([4])}),be(async()=>{r.forEach(l=>{B[l.filter.key]=l.filter.value}),await x([4])}),(l,e)=>{const w=pe,L=me,R=ye("IconBtn"),ne=de,se=ue;return c(),W("div",null,[t(N,{class:"mb-6"},{default:o(()=>[t(P,null,{default:o(()=>[t(ae,null,{default:o(()=>[t(P,null,{default:o(()=>[d("h2",null,"Liste des "+$(s.data.title.plural),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{title:s.filter.title,class:"mb-6"},{default:o(()=>[t(P,null,{default:o(()=>[t(ae,null,{default:o(()=>[(c(!0),W(_e,null,ke(r,a=>(c(),g(we,{key:a.filter.key,cols:a.view.cols.col,sm:a.view.cols.sm??6},{default:o(()=>[t(w,{modelValue:a.filter.value,"onUpdate:modelValue":J=>a.filter.value=J,placeholder:a.base.name,"item-title":a.view.name.itemTitle??"name","item-value":a.view.name.itemValue??"id",items:a.api.datac,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","onUpdate:modelValue","placeholder","item-title","item-value","items"])]),_:2},1032,["cols","sm"]))),128))]),_:1}),t(q,{class:"my-4"})]),_:1}),d("div",Te,[d("div",Se,[t(L,{modelValue:i(y),"onUpdate:modelValue":e[0]||(e[0]=a=>f(y)?y.value=a:null),placeholder:"Rechercher"},null,8,["modelValue"])]),d("div",Ue,[l.$can("create",s.data.rule.name)?(c(),g(V,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:`${s.data.link.base}-add`}},{default:o(()=>[...e[11]||(e[11]=[m(" Nouveau ",-1)])]),_:1},8,["to"])):C("",!0),t(V,{loading:i(_)[3],disabled:i(_)[3],"prepend-icon":"tabler-refresh",onClick:e[1]||(e[1]=a=>x([3,4]))},{loader:o(()=>[d("span",Ae,[t(b,{icon:"tabler-refresh"})])]),default:o(()=>[e[12]||(e[12]=m(" Recharger ",-1))]),_:1},8,["loading","disabled"])])]),t(q,{class:"mt-4"}),t($e,{"items-per-page":i(T),"onUpdate:itemsPerPage":e[3]||(e[3]=a=>f(T)?T.value=a:null),page:i(u),"onUpdate:page":e[4]||(e[4]=a=>f(u)?u.value=a:null),loading:i(_)[4],headers:te,items:i(le),"items-length":i(G),class:"text-no-wrap","loading-text":"En cours de chargement","onUpdate:options":oe},{"item.actions":o(({item:a})=>[d("div",he,[d("div",null,[l.$can("read","location")?(c(),g(R,{key:0,to:{name:`${s.data.link.base}-id`,params:{id:a.id}}},{default:o(()=>[t(M,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:o(()=>[...e[13]||(e[13]=[m(" Details ",-1)])]),_:1}),t(b,{icon:"tabler-eye"})]),_:1},8,["to"])):C("",!0),l.$can("edit","location")?(c(),g(R,{key:1,to:{name:`${s.data.link.base}-edit-id`,params:{id:a.id}}},{default:o(()=>[t(M,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:o(()=>[...e[14]||(e[14]=[m(" Modifier ",-1)])]),_:1}),t(b,{icon:"tabler-edit"})]),_:1},8,["to"])):C("",!0),l.$can("delete","location")?(c(),g(R,{key:2,loading:i(U)[a.id],disabled:i(U)[a.id],onClick:J=>{D.value=a.id,j.value=`Supprimer ${s.data.actions.singular}`,O.value=`Voulez vous vraiment supprimer ${s.data.actions.singular}?`,z.value=ie,Q.value="Supprimer",Y.value=!1,p.value=!0}},{default:o(()=>[t(b,{icon:"tabler-trash",color:"error"}),t(M,{activator:"parent",transition:"scroll-x-transition",location:"bottom"},{default:o(()=>[...e[15]||(e[15]=[m(" Supprimer ",-1)])]),_:1})]),_:1},8,["loading","disabled","onClick"])):C("",!0)])])]),bottom:o(()=>[t(q),d("div",Be,[d("p",Le,$(("paginationMeta"in l?l.paginationMeta:i(re))({page:i(u),itemsPerPage:i(T)},i(G))),1),t(Ce,{modelValue:i(u),"onUpdate:modelValue":e[2]||(e[2]=a=>f(u)?u.value=a:null),length:i(H),"total-visible":l.$vuetify.display.xs?1:Math.min(i(H),5)},{prev:o(a=>[t(V,X({variant:"tonal",color:"default"},a,{icon:!1}),{default:o(()=>[t(b,{start:"",icon:"tabler-arrow-left"}),e[16]||(e[16]=m(" Précedent ",-1))]),_:1},16)]),next:o(a=>[t(V,X({variant:"tonal",color:"default"},a,{icon:!1}),{default:o(()=>[e[17]||(e[17]=m(" Suivant ",-1)),t(b,{end:"",icon:"tabler-arrow-right"})]),_:1},16)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","loading","items","items-length"])]),_:1},8,["title"]),t(Pe,{modelValue:i(p),"onUpdate:modelValue":e[9]||(e[9]=a=>f(p)?p.value=a:null),class:"v-dialog-sm"},{default:o(()=>[t(ne,{onClick:e[5]||(e[5]=a=>p.value=!i(p))}),t(N,{title:i(j)},{default:o(()=>[t(P,null,{default:o(()=>[m($(i(O))+" ",1),i(Y)?(c(),g(se,{key:0,modelValue:i(h),"onUpdate:modelValue":e[6]||(e[6]=a=>f(h)?h.value=a:null),class:"mt-3",label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):C("",!0)]),_:1}),t(P,{class:"d-flex justify-end gap-3 flex-wrap"},{default:o(()=>[t(V,{color:"secondary",variant:"tonal",onClick:e[7]||(e[7]=a=>p.value=!1)},{default:o(()=>[...e[18]||(e[18]=[m(" Retour ",-1)])]),_:1}),t(V,{onClick:e[8]||(e[8]=a=>{i(z)(i(D)),p.value=!1})},{default:o(()=>[m($(i(Q)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),t(Ee,{modelValue:i(v),"onUpdate:modelValue":e[10]||(e[10]=a=>f(v)?v.value=a:null),transition:"scale-transition",location:"top end",color:i(S)},{default:o(()=>[d("div",{textContent:$(i(k))},null,8,Re)]),_:1},8,["modelValue","color"])])}}},_a=xe(Ie,[["__scopeId","data-v-42072080"]]);export{_a as default};
