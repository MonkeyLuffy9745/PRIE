import{V as N,m as ye}from"./VField-CoXLbqml.js";import{a1 as L,Y as p,au as he,ag as ge,aM as be,bA as O,bU as Fe,dd as j,r as D,Z as ke,a2 as we,w as Ce,a6 as De,bX as Ie,bY as x,b as g,p as I,bZ as Ve,b_ as Se,d as m,F as V,v as Ae,b7 as Be,cA as Pe}from"./main-BZyHWxP-.js";import{V as Re}from"./VCounter-D2PtsxdL.js";import{V as Te}from"./VChip-CeQObjZq.js";function ze(){function e(i){return[...i.dataTransfer?.items??[]].filter(l=>l.kind==="file").map(l=>l.webkitGetAsEntry()).filter(Boolean).length>0||[...i.dataTransfer?.files??[]].length>0}async function a(i){const o=[],l=[...i.dataTransfer?.items??[]].filter(n=>n.kind==="file").map(n=>n.webkitGetAsEntry()).filter(Boolean);if(l.length)for(const n of l){const c=await G(n,U(".",n));o.push(...c.map(r=>r.file))}else o.push(...i.dataTransfer?.files??[]);return o}return{handleDrop:a,hasFilesOrFolders:e}}function G(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((i,o)=>{e.isFile?e.file(n=>i([{file:n,path:a}]),o):e.isDirectory&&e.createReader().readEntries(async n=>{const c=[];for(const r of n)c.push(...await G(r,U(a,r)));i(c)})})}function U(e,a){return a.isDirectory?`${e}/${a.name}`:e}const $e=L({filterByType:String},"file-accept");function Ee(e){const a=p(()=>e.filterByType?Me(e.filterByType):null);function i(o){if(a.value){const l=o.filter(a.value);return{accepted:l,rejected:o.filter(n=>!l.includes(n))}}return{accepted:o,rejected:[]}}return{filterAccepted:i}}function Me(e){const a=e.split(",").map(n=>n.trim().toLowerCase()),i=a.filter(n=>n.startsWith(".")),o=a.filter(n=>n.endsWith("/*")),l=a.filter(n=>!i.includes(n)&&!o.includes(n));return n=>{const c=n.name.split(".").at(-1)?.toLowerCase()??"",r=n.type.split("/").at(0)?.toLowerCase()??"";return l.includes(n.type)||i.includes(`.${c}`)||o.includes(`${r}/*`)}}const Ne=L({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},truncateLength:{type:[Number,String],default:22},...Se({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>O(e).every(a=>a!=null&&typeof a=="object")},...$e(),...ye({clearable:!0})},"VFileInput"),Ge=he()({name:"VFileInput",inheritAttrs:!1,props:Ne(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,rejected:e=>!0},setup(e,a){let{attrs:i,emit:o,slots:l}=a;const{t:n}=ge(),{filterAccepted:c}=Ee(e),r=be(e,"modelValue",e.modelValue,t=>O(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:y,focus:W,blur:Y}=Fe(e),S=p(()=>typeof e.showSize!="boolean"?e.showSize:void 0),A=p(()=>(r.value??[]).reduce((t,s)=>{let{size:d=0}=s;return t+d},0)),B=p(()=>j(A.value,S.value)),b=p(()=>(r.value??[]).map(t=>{const{name:s="",size:d=0}=t,f=ee(s);return e.showSize?`${f} (${j(d,S.value)})`:f})),Z=p(()=>{const t=r.value?.length??0;return e.showSize?n(e.counterSizeString,t,B.value):n(e.counterString,t)}),P=D(),R=D(),u=D(),_=ke(()=>y.value||e.active),T=p(()=>["plain","underlined"].includes(e.variant)),h=we(!1),{handleDrop:K,hasFilesOrFolders:X}=ze();function F(){u.value!==document.activeElement&&u.value?.focus(),y.value||W()}function q(t){u.value?.click()}function H(t){o("mousedown:control",t)}function J(t){u.value?.click(),o("click:control",t)}function Q(t){t.stopPropagation(),F(),Be(()=>{r.value=[],Pe(e["onClick:clear"],t)})}function ee(t){if(t.length<Number(e.truncateLength))return t;const s=Math.floor((Number(e.truncateLength)-1)/2);return`${t.slice(0,s)}â€¦${t.slice(t.length-s)}`}function te(t){t.preventDefault(),t.stopImmediatePropagation(),h.value=!0}function ne(t){t.preventDefault(),h.value=!1}async function le(t){if(t.preventDefault(),t.stopImmediatePropagation(),h.value=!1,!u.value||!X(t))return;const s=await K(t);z(s)}function ae(t){if(!(!t.target||t.repack))if(e.filterByType)z([...t.target.files]);else{const s=t.target;r.value=[...s.files??[]]}}function z(t){const s=new DataTransfer,{accepted:d,rejected:f}=c(t);f.length&&o("rejected",f);for(const w of d)s.items.add(w);u.value.files=s.files,r.value=[...s.files];const k=new Event("change",{bubbles:!0});k.repack=!0,u.value.dispatchEvent(k)}return Ce(r,t=>{(!Array.isArray(t)||!t.length)&&u.value&&(u.value.value="")}),De(()=>{const t=!!(l.counter||e.counter),s=!!(t||l.details),[d,f]=Ie(i),{modelValue:k,...w}=x.filterProps(e),ie={...N.filterProps(e),"onClick:clear":Q},re=i.webkitdirectory!==void 0&&i.webkitdirectory!==!1,oe=i.accept?String(i.accept):void 0,se=re?void 0:e.filterByType??oe;return g(x,I({ref:P,modelValue:e.multiple?r.value:r.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":h.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":T.value},e.class],style:e.style,"onClick:prepend":q},d,w,{centerAffix:!T.value,focused:y.value}),{...l,default:C=>{let{id:ue,isDisabled:$,isDirty:E,isReadonly:M,isValid:ce,hasDetails:de}=C;return g(N,I({ref:R,prependIcon:e.prependIcon,onMousedown:H,onClick:J,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},ie,{id:ue.value,active:_.value||E.value,dirty:E.value||e.dirty,disabled:$.value,focused:y.value,details:de.value,error:ce.value===!1,onDragover:te,onDrop:le}),{...l,default:fe=>{let{props:{class:ve,...pe},controlRef:me}=fe;return m(V,null,[m("input",I({ref:v=>u.value=me.value=v,type:"file",accept:se,readonly:M.value,disabled:$.value,multiple:e.multiple,name:e.name,onClick:v=>{v.stopPropagation(),M.value&&v.preventDefault(),F()},onChange:ae,onDragleave:ne,onFocus:F,onBlur:Y},pe,f),null),m("div",{class:Ae(ve)},[!!r.value?.length&&!e.hideInput&&(l.selection?l.selection({fileNames:b.value,totalBytes:A.value,totalBytesReadable:B.value}):e.chips?b.value.map(v=>g(Te,{key:v,size:"small",text:v},null)):b.value.join(", "))])])}})},details:s?C=>m(V,null,[l.details?.(C),t&&m(V,null,[m("span",null,null),g(Re,{active:!!r.value?.length,value:Z.value,disabled:e.disabled},l.counter)])]):void 0})}),Ve({},P,R,u)}});export{Ge as V};
