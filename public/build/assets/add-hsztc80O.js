import{i as D,dG as g,bi as z,r as y,Y as I,c as $,o as k,d as l,b as s,t as d,e as r,f as E,k as O,F as R,h as H,s as V,_ as C,bg as G,ah as U,ba as Y,b7 as J}from"./main-B_3U4rnL.js";import{_ as K}from"./FieldRenderer-BkYsa3Yc.js";import{u as Q}from"./useApi-2ULgWkV5.js";import{c as W}from"./createUrl-DSuaXwyR.js";import{$ as X}from"./api-CXpAJbKn.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as q,a as x}from"./VRow-rSP3UPT0.js";import{V as F}from"./VCard-CHvE1CVF.js";import{V as j}from"./VCardText-CbE5M2-5.js";import{V as ee}from"./VForm-CjsMgpeM.js";import{V as te}from"./VSnackbar-XjXLO0OV.js";import"./AppDateTimePicker-C5PQHceF.js";import"./VField-3YJ8FXmc.js";import"./TiptapEditor-R1VBqz69.js";import"./index-CC9o5_Jl.js";import"./index-DzVQabXu.js";import"./VDivider-CHuFBZ5S.js";import"./validators-DpYrMFzk.js";import"./helpers-DK5QwNv0.js";import"./VTextField-eMdtVNtb.js";import"./autofocus-Bw9dR2w9.js";import"./VCounter-D_guRIhI.js";import"./VTextarea-hCZEX-uB.js";import"./VAutocomplete-B6b0HexW.js";import"./VSelect-DQ-4196m.js";import"./VList-Ce9acDAh.js";import"./ssrBoot-DCfCAOKs.js";import"./VAvatar-K7hB1Kku.js";import"./VCheckboxBtn-DobkZaJy.js";import"./VSelectionControl-DLNDeEFn.js";import"./VChip-BAqKzKSp.js";import"./VSlideGroup-CCtB-AAW.js";import"./filter-DTgM_L49.js";import"./VSwitch-Dky9GR1R.js";import"./VFileInput-QALlyd5V.js";import"./index-CvOPxmL5.js";const ae={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},se={class:"d-flex flex-column justify-center"},re={class:"text-h4 font-weight-medium"},oe={class:"d-flex justify-space-between align-center mb-2"},le={class:"text-sm text-medium-emphasis"},ie={class:"text-sm text-medium-emphasis"},ne={class:"text-center mt-1"},ue={class:"text-sm text-medium-emphasis"},me={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},ce={class:"d-flex gap-4 align-center flex-wrap"},de=["innerHTML"],pe={__name:"add",async setup(_e){let f,w;const M=D(),p={api:{endpoint:"user",method:"POST"},back_route_name:"user"},N={create:"créé avec succès",update:"modifié avec succès",delete:"supprimé avec succès"},b={upload:{network:"Erreur de connexion lors de l'upload",size:"Fichier trop volumineux",format:"Format de fichier non supporté"}},T={endpoints:{upload:`/${p.api.endpoint}/upload-chunk`,merge:`/${p.api.endpoint}/merge-chunks`,create:`/${p.api.endpoint}`},methods:{upload:"POST",merge:"POST",create:p.api.method}},P=(t,a)=>t.type==="file"&&a[t.value_key]?a[t.value_key].map(e=>e.includes("size")?b.upload.size:e.includes("format")||e.includes("extension")?b.upload.format:e):a[t.value_key],n=g({name:"Utilisateur",back_name:"un",second_back_name:"utilisateur",api:{is_loading:!1}}),i=g({isUploading:!1,progress:0,currentChunk:0,totalChunks:0,fileName:""}),o=g([{type:"text",label:"Nom",value_key:"first_name",default_value:"TEST",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6}},{type:"text",label:"Prénom",value_key:"last_name",default_value:"TEST",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6}},{type:"text",label:"Email",default_value:"TEST@gmail.com",value_key:"email",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6}},{type:"text",label:"Téléphone",value_key:"mobile",default_value:"91611135",errors:null,required:!0,cols:{cols:12,sm:6,md:6,lg:6}},{type:"lov",label:"Profil",value_key:"profile",errors:null,required:!0,default_value:"test",cols:{cols:12,sm:6,md:6,lg:6},data:{list:{id:"id",name:"name",source:"array",api:{endpoint:null,query:{},execute:null,data:null},items:[{id:"admin",name:"Administrateur"},{id:"agent",name:"Agent"},{id:"ministry",name:"Ministère"}],multiple:!1}}},{type:"text",label:"Mot de passe",value_key:"password",errors:null,required:!0,default_value:"testtest",cols:{cols:12,sm:6,md:6,lg:6}}]),v=g(o.reduce((t,a)=>("default_value"in a?t[a.value_key]=a.default_value??null:t[a.value_key]=null,t),{}));for(let t=0;t<o.length;t++)if(o[t].type==="lov"&&o[t].data.list.source==="api"){const{data:a,execute:e}=([f,w]=z(()=>Q(W(`/${o[t].data.list.api.endpoint}`,{query:o[t].data.list.api.query}))),f=await f,w(),f);o[t].data.list.api.data=a,o[t].data.list.api.execute=e,o[t].data.list.items=o[t].data.list.api.data.data}function S(){o.forEach(t=>{t.errors=null})}function L(){i.isUploading=!1,i.progress=0,i.currentChunk=0,i.totalChunks=0,i.fileName=""}const h=y(),A=()=>{h.value?.validate().then(async({valid:t})=>{if(n.api.is_loading=!0,t){try{const a={...v};S();const e=await X(T.endpoints.create,{method:T.methods.create,body:a});if(e?.status==201)m.value=`${n.name} ${N.create}`,_.value="success",c.value=!0,M.push({name:p.back_route_name});else if(e?.errors){for(const u of o)e.errors[u.value_key]&&(u.errors=P(u,e.errors));m.value="";for(const u in e.errors)e.errors[u]&&(m.value+=`${e.errors[u]}`);_.value="error",c.value=!!m.value}else m.value=e?.message??"Une erreur inconnue est survenue.",_.value="error",c.value=!0}catch(a){S(),L(),m.value=a.message??b.upload.network,_.value="error",c.value=!0}J(()=>{h.value?.resetValidation()})}n.api.is_loading=!1})},c=y(!1),m=y(""),_=y("success"),B=I(()=>o.filter(t=>!t.active||t.active()));return(t,a)=>(k(),$("div",null,[l("div",ae,[l("div",se,[l("h4",re," Ajouter "+d(n.back_name)+" "+d(n.name),1)])]),s(ee,{ref_key:"refForm",ref:h,onSubmit:Y(A,["prevent"])},{default:r(()=>[s(q,null,{default:r(()=>[s(x,{md:"12"},{default:r(()=>[s(F,{class:"mb-6",title:`Informations sur ${n.second_back_name} ${n.name}`},{default:r(()=>[s(j,null,{default:r(()=>[s(q,null,{default:r(()=>[(k(!0),$(R,null,H(B.value,e=>(k(),E(x,{key:e.value_key,cols:(e.getCols?e.getCols():e.cols).cols??12,sm:(e.getCols?e.getCols():e.cols).sm??12,md:(e.getCols?e.getCols():e.cols).md??12,lg:(e.getCols?e.getCols():e.cols).lg??12},{default:r(()=>[s(K,{modelValue:v[e.value_key],"onUpdate:modelValue":u=>v[e.value_key]=u,field:e,context:{type:v.type}},null,8,["modelValue","onUpdate:modelValue","field","context"])]),_:2},1032,["cols","sm","md","lg"]))),128))]),_:1})]),_:1})]),_:1},8,["title"])]),_:1}),i.isUploading?(k(),E(x,{key:0,cols:"12"},{default:r(()=>[s(F,null,{default:r(()=>[s(j,null,{default:r(()=>[l("div",oe,[l("span",le,[s(C,{icon:"tabler-upload",class:"me-2"}),V(" Upload en cours: "+d(i.fileName),1)]),l("span",ie,d(i.currentChunk)+"/"+d(i.totalChunks)+" chunks ",1)]),s(G,{"model-value":i.progress,color:"primary",height:"8",rounded:"",striped:""},null,8,["model-value"]),l("div",ne,[l("span",ue,d(i.progress)+"% ",1)])]),_:1})]),_:1})]),_:1})):O("",!0),s(x,{cols:"12"},{default:r(()=>[l("div",me,[a[3]||(a[3]=l("div",{class:"d-flex flex-column justify-center"},null,-1)),l("div",ce,[s(U,{type:"reset",variant:"tonal",color:"primary"},{default:r(()=>[s(C,{start:"",icon:"tabler-circle-minus"}),a[1]||(a[1]=V(" Effacer ",-1))]),_:1}),s(U,{type:"submit",loading:n.api.is_loading,disabled:n.api.is_loading,class:"me-3"},{default:r(()=>[a[2]||(a[2]=V(" Enregistrer ",-1)),s(C,{end:"",icon:"tabler-checkbox"})]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1})]),_:1},512),s(te,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),transition:"scale-transition",location:"top end",color:_.value},{default:r(()=>[l("div",{innerHTML:m.value},null,8,de)]),_:1},8,["modelValue","color"])]))}},We=Z(pe,[["__scopeId","data-v-74cf6ac7"]]);export{We as default};
