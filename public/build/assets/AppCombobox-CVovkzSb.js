import{au as Ae,a1 as De,ag as Pe,r as K,a2 as C,bw as Re,aM as J,bA as Me,c$ as Ee,Y as p,b7 as A,dl as Le,w as D,ar as Q,a6 as Te,b as d,p as k,bZ as Be,bR as Ne,dm as $e,d1 as X,cs as Oe,d as w,_ as ee,dn as Ke,F as W,b0 as ze,d3 as Ue,H as je,v as se,aL as He,s as qe,d4 as le,bW as We,c as Ye,o as ae,f as Ze,k as Ge,l as z,b3 as Je,be as Qe,h as Xe,e as el,y as ll,ai as te,aj as ne}from"./main-B_3U4rnL.js";import{u as al,a as tl,m as nl,b as ul}from"./VSelect-DQ-4196m.js";import{V as ue,m as ol}from"./VTextField-eMdtVNtb.js";import{u as sl,m as il,h as rl}from"./filter-DTgM_L49.js";import{u as cl,t as P,V as vl,a as oe,c as dl}from"./VList-Ce9acDAh.js";import{V as fl}from"./VDivider-CHuFBZ5S.js";import{V as ml}from"./VCheckboxBtn-DobkZaJy.js";import{V as bl}from"./VAvatar-K7hB1Kku.js";import{V as hl}from"./VChip-BAqKzKSp.js";const pl=De({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...il({filterKeys:["title"]}),...nl({hideNoData:!0,returnObject:!0}),...Ne(ol({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"])},"VCombobox"),gl=Ae()({name:"VCombobox",props:pl(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,R){let{emit:M,slots:u}=R;const{t:I}=Pe(),f=K(),b=C(!1),h=C(!0),U=C(!1),Y=K(),E=K(),s=C(-1);let L=!1;const{items:Z,transformIn:ie,transformOut:re}=cl(e),{textColorClasses:ce,textColorStyles:ve}=Re(()=>f.value?.color),n=J(e,"modelValue",[],l=>ie(Me(l)),l=>{const o=re(l);return e.multiple?o:o[0]??null}),T=Ee(e),B=p(()=>!!(e.chips||u.chip)),y=p(()=>B.value||!!u.selection),g=C(!e.multiple&&!y.value?n.value[0]?.title??"":""),S=C(null),c=p({get:()=>g.value,set:async l=>{if(g.value=l??"",l===null||l===""&&!e.multiple&&!y.value?n.value=[]:!e.multiple&&!y.value&&(n.value=[P(e,l)],A(()=>E.value?.scrollToIndex(0))),l&&e.multiple&&e.delimiters?.length){const o=e.delimiters.map(Le).join("|"),v=l.split(new RegExp(`(?:${o})+`));if(v.length>1){for(let a of v)a=a.trim(),a&&(x(P(e,a)),await A());g.value=""}}l||(s.value=-1),h.value=!l}}),de=p(()=>typeof e.counterValue=="function"?e.counterValue(n.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?n.value.length:c.value.length),{filteredItems:N,getMatches:fe}=sl(e,Z,()=>S.value??(e.alwaysFilter||!h.value?c.value:"")),V=p(()=>e.hideSelected&&S.value===null?N.value.filter(l=>!n.value.some(o=>o.value===l.value)):N.value),$=p(()=>e.hideNoData&&!V.value.length||T.isReadonly.value||T.isDisabled.value),j=J(e,"menu"),r=p({get:()=>j.value,set:l=>{j.value&&!l&&Y.value?.Î¨openChildren.size||l&&$.value||(j.value=l)}}),{menuId:me,ariaExpanded:be,ariaControls:he,ariaLabel:G}=al(e,r);D(g,l=>{L?A(()=>L=!1):b.value&&!r.value&&(r.value=!0),M("update:search",l)}),D(n,l=>{!e.multiple&&!y.value&&(g.value=l[0]?.title??"")});const pe=p(()=>n.value.map(l=>l.value)),H=p(()=>(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&c.value===V.value[0]?.title)&&V.value.length>0&&!h.value&&!U.value),q=K(),ge=tl(q,f);function xe(l){L=!0,A(()=>L=!1),e.openOnClear&&(r.value=!0)}function ye(){$.value||(r.value=!0)}function Ve(l){$.value||(b.value&&(l.preventDefault(),l.stopPropagation()),r.value=!r.value)}function ke(l){(X(l)||l.key==="Backspace")&&f.value?.focus()}function Ce(l){if($e(l)||T.isReadonly.value)return;const o=f.value?.selectionStart,v=n.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),H.value&&["Enter","Tab"].includes(l.key)&&!n.value.some(a=>{let{value:t}=a;return t===V.value[0].value})&&x(N.value[0]),l.key==="ArrowDown"&&H.value&&q.value?.focus("next"),l.key==="Enter"&&c.value&&(x(P(e,c.value),!0,!0),y.value&&(g.value="")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&y.value&&n.value.length>0&&!c.value)return x(n.value[0],!1);if(~s.value){l.preventDefault();const a=s.value;x(n.value[s.value],!1),s.value=a>=v-1?v-2:a}else l.key==="Backspace"&&!c.value&&(s.value=v-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(s.value<0&&o&&o>0)return;const a=s.value>-1?s.value-1:v-1;n.value[a]?s.value=a:(s.value=-1,f.value?.setSelectionRange(c.value.length,c.value.length))}else if(l.key==="ArrowRight"){if(s.value<0)return;const a=s.value+1;n.value[a]?s.value=a:(s.value=-1,f.value?.setSelectionRange(0,0))}else~s.value&&X(l)&&(s.value=-1)}function we(){e.eager&&E.value?.calculateVisibleItems()}function Ie(){b.value&&f.value?.focus(),h.value=!0,S.value=null}function x(l){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!l||l.props.disabled))if(e.multiple){const a=n.value.findIndex(i=>(e.valueComparator||Q)(i.value,l.value)),t=o??!~a;if(~a){const i=t?[...n.value,l]:[...n.value];i.splice(a,1),n.value=i}else t&&(n.value=[...n.value,l]);e.clearOnSelect&&(c.value="")}else{const a=o!==!1;n.value=a?[l]:[],(!h.value||e.alwaysFilter)&&g.value&&(S.value=g.value),g.value=a&&!y.value?l.title:"",A(()=>{r.value=v,h.value=!0})}}function Se(l){b.value=!0,setTimeout(()=>{U.value=!0})}function Fe(l){U.value=!1}return D(b,(l,o)=>{if(!(l||l===o)&&(s.value=-1,r.value=!1,c.value)){if(e.multiple){x(P(e,c.value));return}if(!y.value)return;n.value.some(v=>{let{title:a}=v;return a===c.value})?g.value="":x(P(e,c.value))}}),D(r,l=>{if(!e.hideSelected&&l&&n.value.length&&h.value){const o=V.value.findIndex(v=>n.value.some(a=>(e.valueComparator||Q)(a.value,v.value)));Oe&&window.requestAnimationFrame(()=>{o>=0&&E.value?.scrollToIndex(o)})}l&&(S.value=null)}),D(Z,(l,o)=>{r.value||b.value&&!o.length&&l.length&&(r.value=!0)}),Te(()=>{const l=!!(!e.hideNoData||V.value.length||u["prepend-item"]||u["append-item"]||u["no-data"]),o=n.value.length>0,v=ue.filterProps(e);return d(ue,k({ref:f},v,{modelValue:c.value,"onUpdate:modelValue":a=>c.value=a,focused:b.value,"onUpdate:focused":a=>b.value=a,validationValue:n.externalValue,counterValue:de.value,dirty:o,class:["v-combobox",{"v-combobox--active-menu":r.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!y.value,"v-combobox--selecting-index":s.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:T.isReadonly.value,placeholder:o?void 0:e.placeholder,"onClick:clear":xe,"onMousedown:control":ye,onKeydown:Ce,"aria-expanded":be.value,"aria-controls":he.value}),{...u,default:()=>w(W,null,[d(ze,k({id:me.value,ref:Y,modelValue:r.value,"onUpdate:modelValue":a=>r.value=a,activator:"parent",contentClass:"v-combobox__content",disabled:$.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:we,onAfterLeave:Ie},e.menuProps),{default:()=>[l&&d(vl,k({ref:q,filterable:!0,selected:pe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),selectable:!0,onKeydown:ke,onFocusin:Se,onFocusout:Fe,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},ge,e.listProps),{default:()=>[u["prepend-item"]?.(),!V.value.length&&!e.hideNoData&&(u["no-data"]?.()??d(oe,{key:"no-data",title:I(e.noDataText)},null)),d(ul,{ref:E,renderless:!0,items:V.value,itemKey:"value"},{default:a=>{let{item:t,index:i,itemRef:O}=a;const F=k(t.props,{ref:O,key:t.value,active:H.value&&i===0?!0:void 0,onClick:()=>x(t,null)});return t.type==="divider"?u.divider?.({props:t.raw,index:i})??d(fl,k(t.props,{key:`divider-${i}`}),null):t.type==="subheader"?u.subheader?.({props:t.raw,index:i})??d(dl,k(t.props,{key:`subheader-${i}`}),null):u.item?.({item:t,index:i,props:F})??d(oe,k(F,{role:"option"}),{prepend:_=>{let{isSelected:m}=_;return w(W,null,[e.multiple&&!e.hideSelected?d(ml,{key:t.value,modelValue:m,ripple:!1,tabindex:"-1",onClick:_e=>_e.preventDefault()},null):void 0,t.props.prependAvatar&&d(bl,{image:t.props.prependAvatar},null),t.props.prependIcon&&d(ee,{icon:t.props.prependIcon},null)])},title:()=>h.value?t.title:rl("v-combobox",t.title,fe(t)?.title)})}}),u["append-item"]?.()]})]}),n.value.map((a,t)=>{function i(m){m.stopPropagation(),m.preventDefault(),x(a,!1)}const O={"onClick:close":i,onKeydown(m){m.key!=="Enter"&&m.key!==" "||(m.preventDefault(),m.stopPropagation(),i(m))},onMousedown(m){m.preventDefault(),m.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},F=B.value?!!u.chip:!!u.selection,_=F?Ue(B.value?u.chip({item:a,index:t,props:O}):u.selection({item:a,index:t})):void 0;if(!(F&&!_))return w("div",{key:a.value,class:se(["v-combobox__selection",t===s.value&&["v-combobox__selection--selected",ce.value]]),style:je(t===s.value?ve.value:{})},[B.value?u.chip?d(He,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:a.title}}},{default:()=>[_]}):d(hl,k({key:"chip",closable:e.closableChips,size:"small",text:a.title,disabled:a.props.disabled},O),null):_??w("span",{class:"v-combobox__selection-text"},[a.title,e.multiple&&t<n.value.length-1&&w("span",{class:"v-combobox__selection-comma"},[qe(",")])])])})]),"append-inner":function(){for(var a=arguments.length,t=new Array(a),i=0;i<a;i++)t[i]=arguments[i];return w(W,null,[u["append-inner"]?.(...t),(!e.hideNoData||e.items.length)&&e.menuIcon?d(ee,{class:"v-combobox__menu-icon",color:f.value?.fieldIconColor,icon:e.menuIcon,onMousedown:Ve,onClick:Ke,"aria-label":G.value,title:G.value,tabindex:"-1"},null):void 0])}})}),Be({isFocused:b,isPristine:h,menu:r,search:c,selectionIndex:s,filteredItems:N,select:x},f)}}),_l=Object.assign({name:"AppCombobox",inheritAttrs:!1},{__name:"AppCombobox",setup(e){const R=p(()=>{const I=le().id,f=We();return I?`app-combobox-${I}`:f}),M=p(()=>le().label);return(u,I)=>(ae(),Ye("div",{class:se(["app-combobox flex-grow-1",u.$attrs.class])},[z(M)?(ae(),Ze(Je,{key:0,for:z(R),class:"mb-1 text-body-2",text:z(M)},null,8,["for","text"])):Ge("",!0),d(gl,te(ne({...u.$attrs,class:null,label:void 0,variant:"outlined",id:z(R),menuProps:{contentClass:["app-inner-list","app-combobox__content","v-combobox__content",u.$attrs.multiple!==void 0?"v-list-select-multiple":""]}})),Qe({_:2},[Xe(u.$slots,(f,b)=>({name:b,fn:el(h=>[ll(u.$slots,b,te(ne(h||{})))])}))]),1040)],2))}});export{gl as V,_l as _};
