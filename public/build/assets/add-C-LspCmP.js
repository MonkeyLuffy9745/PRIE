import{i as R,dE as g,bi as z,r as y,Y as A,c as T,o as k,d as l,b as s,t as m,e as o,f as U,k as I,F as O,h as H,s as V,_ as C,bg as Y,ah as E,ba as G,b7 as J}from"./main-BEYAFsWY.js";import{_ as K}from"./FieldRenderer-Cz-yNU6Q.js";import{u as Q}from"./useApi-DL_wWqQ9.js";import{c as W}from"./createUrl-CNJYluNR.js";import{$ as X}from"./api-N0CH2dad.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as F,a as x}from"./VRow-DhucUJ_c.js";import{V as N}from"./VCard-DAB_Bu5L.js";import{V as j}from"./VCardText-BoDvIV3o.js";import{V as ee}from"./VForm-CeWIqL2A.js";import{V as te}from"./VSnackbar-ChDeThqV.js";import"./AppDateTimePicker-Ck2kECz9.js";import"./VField-9ku5YizL.js";import"./TiptapEditor-CumRvCuf.js";import"./index-Di2lUOdg.js";import"./index-BGBhiaSc.js";import"./VDivider-CFXljG1d.js";import"./validators-DpYrMFzk.js";import"./helpers-DK5QwNv0.js";import"./VTextField-Dp2G28tr.js";import"./autofocus-sxRgyBjq.js";import"./VCounter-CG_HpDHy.js";import"./VTextarea-B7IpR3s5.js";import"./VAutocomplete-BLVUhDue.js";import"./VSelect-BCqqkMkZ.js";import"./VList-BOjC5y0z.js";import"./ssrBoot-CAyz4zn7.js";import"./VAvatar-B5UblNHH.js";import"./VCheckboxBtn-Civ28FTj.js";import"./VSelectionControl-Dq5wMchr.js";import"./VChip-DQe73DDG.js";import"./VSlideGroup-CcoO5AYH.js";import"./filter-CZ8mmpcR.js";import"./VSwitch-DBnLEmYl.js";import"./VFileInput-Bh7HH5Ki.js";import"./index-CvOPxmL5.js";const ae={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},se={class:"d-flex flex-column justify-center"},oe={class:"text-h4 font-weight-medium"},re={class:"d-flex justify-space-between align-center mb-2"},le={class:"text-sm text-medium-emphasis"},ie={class:"text-sm text-medium-emphasis"},ne={class:"text-center mt-1"},ue={class:"text-sm text-medium-emphasis"},ce={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},de={class:"d-flex gap-4 align-center flex-wrap"},me=["innerHTML"],pe={__name:"add",async setup(fe){let _,w;const P=R(),p={api:{endpoint:"location",method:"POST"},back_route_name:"location"},q={create:"créé avec succès",update:"modifié avec succès",delete:"supprimé avec succès"},h={upload:{network:"Erreur de connexion lors de l'upload",size:"Fichier trop volumineux",format:"Format de fichier non supporté"}},$={endpoints:{upload:`/${p.api.endpoint}/upload-chunk`,merge:`/${p.api.endpoint}/merge-chunks`,create:`/${p.api.endpoint}`},methods:{upload:"POST",merge:"POST",create:p.api.method}},L=(t,a)=>t.type==="file"&&a[t.value_key]?a[t.value_key].map(e=>e.includes("size")?h.upload.size:e.includes("format")||e.includes("extension")?h.upload.format:e):a[t.value_key],n=g({name:"Localisation",back_name:"une",second_back_name:"localisation",api:{is_loading:!1}}),i=g({isUploading:!1,progress:0,currentChunk:0,totalChunks:0,fileName:""}),r=g([{type:"text",label:"Nom",value_key:"name",default_value:"TEST",errors:null,required:!0,cols:{cols:12,sm:12,md:12,lg:12}},{type:"lov",label:"Niveau",value_key:"level",errors:null,required:!0,default_value:"region",cols:{cols:12,sm:12,md:12,lg:12},data:{list:{id:"id",name:"name",source:"array",api:{endpoint:null,query:{},execute:null,data:null},items:[{id:"region",name:"Région"},{id:"prefecture",name:"Préfecture"}],multiple:!1}}},{type:"lov",label:"Parent",value_key:"parent_id",errors:null,required:!1,default_value:null,clearable:!0,cols:{cols:12,sm:12,md:12,lg:12},data:{list:{id:"id",name:"name",source:"api",api:{endpoint:"location",query:{},execute:null,data:null},items:[],multiple:!1}}}]),v=g(r.reduce((t,a)=>("default_value"in a?t[a.value_key]=a.default_value??null:t[a.value_key]=null,t),{}));for(let t=0;t<r.length;t++)if(r[t].type==="lov"&&r[t].data.list.source==="api"){const{data:a,execute:e}=([_,w]=z(()=>Q(W(`/${r[t].data.list.api.endpoint}`,{query:r[t].data.list.api.query}))),_=await _,w(),_);r[t].data.list.api.data=a,r[t].data.list.api.execute=e,r[t].data.list.items=r[t].data.list.api.data.data}function S(){r.forEach(t=>{t.errors=null})}function M(){i.isUploading=!1,i.progress=0,i.currentChunk=0,i.totalChunks=0,i.fileName=""}const b=y(),B=()=>{b.value?.validate().then(async({valid:t})=>{if(n.api.is_loading=!0,t){try{const a={...v};S();const e=await X($.endpoints.create,{method:$.methods.create,body:a});if(e?.status==201)c.value=`${n.name} ${q.create}`,f.value="success",d.value=!0,P.push({name:p.back_route_name});else if(e?.errors){for(const u of r)e.errors[u.value_key]&&(u.errors=L(u,e.errors));c.value="";for(const u in e.errors)e.errors[u]&&(c.value+=`${e.errors[u]}`);f.value="error",d.value=!!c.value}else c.value=e?.message??"Une erreur inconnue est survenue.",f.value="error",d.value=!0}catch(a){S(),M(),c.value=a.message??h.upload.network,f.value="error",d.value=!0}J(()=>{b.value?.resetValidation()})}n.api.is_loading=!1})},d=y(!1),c=y(""),f=y("success"),D=A(()=>r.filter(t=>!t.active||t.active()));return(t,a)=>(k(),T("div",null,[l("div",ae,[l("div",se,[l("h4",oe," Ajouter "+m(n.back_name)+" "+m(n.name),1)])]),s(ee,{ref_key:"refForm",ref:b,onSubmit:G(B,["prevent"])},{default:o(()=>[s(F,null,{default:o(()=>[s(x,{md:"12"},{default:o(()=>[s(N,{class:"mb-6",title:`Informations sur ${n.second_back_name} ${n.name}`},{default:o(()=>[s(j,null,{default:o(()=>[s(F,null,{default:o(()=>[(k(!0),T(O,null,H(D.value,e=>(k(),U(x,{key:e.value_key,cols:(e.getCols?e.getCols():e.cols).cols??12,sm:(e.getCols?e.getCols():e.cols).sm??12,md:(e.getCols?e.getCols():e.cols).md??12,lg:(e.getCols?e.getCols():e.cols).lg??12},{default:o(()=>[s(K,{modelValue:v[e.value_key],"onUpdate:modelValue":u=>v[e.value_key]=u,field:e,context:{type:v.type}},null,8,["modelValue","onUpdate:modelValue","field","context"])]),_:2},1032,["cols","sm","md","lg"]))),128))]),_:1})]),_:1})]),_:1},8,["title"])]),_:1}),i.isUploading?(k(),U(x,{key:0,cols:"12"},{default:o(()=>[s(N,null,{default:o(()=>[s(j,null,{default:o(()=>[l("div",re,[l("span",le,[s(C,{icon:"tabler-upload",class:"me-2"}),V(" Upload en cours: "+m(i.fileName),1)]),l("span",ie,m(i.currentChunk)+"/"+m(i.totalChunks)+" chunks ",1)]),s(Y,{"model-value":i.progress,color:"primary",height:"8",rounded:"",striped:""},null,8,["model-value"]),l("div",ne,[l("span",ue,m(i.progress)+"% ",1)])]),_:1})]),_:1})]),_:1})):I("",!0),s(x,{cols:"12"},{default:o(()=>[l("div",ce,[a[3]||(a[3]=l("div",{class:"d-flex flex-column justify-center"},null,-1)),l("div",de,[s(E,{type:"reset",variant:"tonal",color:"primary"},{default:o(()=>[s(C,{start:"",icon:"tabler-circle-minus"}),a[1]||(a[1]=V(" Effacer ",-1))]),_:1}),s(E,{type:"submit",loading:n.api.is_loading,disabled:n.api.is_loading,class:"me-3"},{default:o(()=>[a[2]||(a[2]=V(" Enregistrer ",-1)),s(C,{end:"",icon:"tabler-checkbox"})]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1})]),_:1},512),s(te,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),transition:"scale-transition",location:"top end",color:f.value},{default:o(()=>[l("div",{innerHTML:c.value},null,8,me)]),_:1},8,["modelValue","color"])]))}},We=Z(pe,[["__scopeId","data-v-d4d7a564"]]);export{We as default};
